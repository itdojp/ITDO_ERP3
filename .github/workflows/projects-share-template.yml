name: Projects Slack Share Check

on:
  schedule:
    # Runs weekly on Mondays at 2 AM UTC
    - cron: '0 2 * * 1'
  workflow_dispatch: {}

jobs:
  generate-share-template:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20.x'
      - name: Install UI dependencies
        run: npm install
        working-directory: ui-poc
      - name: Generate sample Projects share message
        run: npm run --silent share:projects:sample
        working-directory: ui-poc
      - name: Verify CLI markdown/json output
        run: |
          node scripts/project-share-slack.js --url 'https://example.com/projects?status=active&manager=Yamada&tags=DX,SAP' --title 'CI Check' --notes 'format check' --format markdown > /tmp/share.md
          test -s /tmp/share.md
          node scripts/project-share-slack.js --url 'https://example.com/projects?status=active&manager=Yamada&tags=DX,SAP' --title 'CI Check' --notes 'format check' --format json | jq -e '.filters.manager == "Yamada" and .notes == "format check"'
